<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Habit Grid</title>

  <style>
    :root{
      --bg:#0b0f17;
      --panel:#121826;
      --line:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.95);
      --muted:rgba(255,255,255,.6);
      --accent:#7c5cff;
      --good:#2ee59d;
      --mid:#ffd166;
      --bad:#ff5c7a;

      --sq:14px;
      --gap:6px;
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(900px 500px at 20% -10%, rgba(124,92,255,.25), transparent 60%),
        radial-gradient(700px 400px at 110% 10%, rgba(46,229,157,.18), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      padding:16px;
      background:rgba(11,15,23,.85);
      backdrop-filter:blur(12px);
      border-bottom:1px solid var(--line);
    }

    h1{
      margin:0;
      font-size:20px;
      font-weight:800;
    }

    .sub{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
    }

    main{
      padding:14px 14px 100px;
      max-width:820px;
      margin:0 auto;
    }

    .gallery{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
    }

    .cardTop{
      padding:14px;
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:flex-start;
      flex-wrap:wrap;
    }

    .cardTitle{
      flex:1 1 auto;
      min-width:0;
    }

    .habitName{
      font-size:16px;
      font-weight:750;
      line-height:1.2;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .meta{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
    }

    .actions{
      display:flex;
      gap:8px;
      flex:0 0 auto;
    }

    button{
      border:1px solid var(--line);
      background:rgba(0,0,0,.2);
      color:var(--text);
      padding:8px 12px;
      border-radius:12px;
      font-size:13px;
      font-weight:700;
    }

    .primary{
      background:rgba(124,92,255,.25);
      border-color:rgba(124,92,255,.45);
    }

    .danger{
      background:rgba(255,92,122,.2);
      border-color:rgba(255,92,122,.4);
    }

    .months{
      display:flex;
      gap:14px;
      padding:14px;
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
    }

    .month{
      min-width:230px;
      flex:0 0 auto;
    }

    .monthHead{
      font-size:12px;
      font-weight:800;
      margin-bottom:6px;
      color:rgba(255,255,255,.75);
    }

    .monthGrid{
      display:grid;
      grid-template-columns:repeat(7,var(--sq));
      gap:var(--gap);
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }

    .sq{
      width:var(--sq);
      height:var(--sq);
      border-radius:4px;
      background:rgba(255,255,255,.07);
    }

    .sq[data-level="1"]{background:rgba(255,92,122,.45)}
    .sq[data-level="2"]{background:rgba(255,209,102,.55)}
    .sq[data-level="3"]{background:rgba(46,229,157,.6)}

    .sq.today{
      outline:2px solid rgba(124,92,255,.7);
    }

    .fab{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      padding:14px 14px calc(14px + env(safe-area-inset-bottom));
      background:linear-gradient(to top,rgba(11,15,23,.9),transparent);
    }

    .fab button{
      width:100%;
      padding:14px;
      border-radius:16px;
      font-size:15px;
    }

    /* Modal */
    .backdrop{
      position:fixed;
      inset:0;
      display:none;
      align-items:flex-end;
      background:rgba(0,0,0,.6);
      z-index:50;
    }

    .modal{
      width:100%;
      max-width:640px;
      background:rgba(18,24,36,.97);
      border-radius:20px 20px 0 0;
      padding:16px;
      border:1px solid var(--line);
    }

    label{
      font-size:12px;
      color:var(--muted);
    }

    input,select{
      width:100%;
      padding:12px;
      border-radius:14px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      color:var(--text);
      font-size:15px;
    }

    .row{
      display:flex;
      gap:10px;
    }
  </style>
</head>

<body>
<header>
  <h1>Habit Grid</h1>
  <div class="sub">Tap days to log • Scroll months horizontally</div>
</header>

<main>
  <div id="gallery" class="gallery"></div>
</main>

<div class="fab">
  <button class="primary" id="addBtn">＋ Add habit</button>
</div>

<div class="backdrop" id="modalBack">
  <div class="modal">
    <div id="modalBody"></div>
    <div class="row" style="margin-top:12px">
      <button id="cancelBtn">Cancel</button>
      <button class="primary" id="saveBtn">Save</button>
    </div>
  </div>
</div>

<script>
const STORAGE="habit_grid_v1";
const state=JSON.parse(localStorage.getItem(STORAGE)||'{"habits":[]}');
const today=new Date();today.setHours(12,0,0,0);

function ymd(d){
  return d.toISOString().slice(0,10);
}

function save(){
  localStorage.setItem(STORAGE,JSON.stringify(state));
}

function openModal(html,onSave){
  modalBody.innerHTML=html;
  modalBack.style.display="flex";
  saveBtn.onclick=onSave;
}

cancelBtn.onclick=()=>modalBack.style.display="none";

addBtn.onclick=()=>{
  openModal(`
    <label>Name</label>
    <input id="hName">
    <label style="margin-top:10px">Type</label>
    <select id="hType">
      <option value="yn">Yes / No</option>
      <option value="num">Numeric</option>
    </select>
    <label id="tLabel" style="margin-top:10px;display:none">Target</label>
    <input id="hTarget" type="number" inputmode="numeric" style="display:none">
  `,()=>{
    const name=hName.value.trim();
    const type=hType.value;
    if(!name)return;
    state.habits.push({id:crypto.randomUUID(),name,type,target:hTarget.value?Number(hTarget.value):null,logs:{}});
    save();
    modalBack.style.display="none";
    render();
  });
  hType.onchange=()=>{
    const show=hType.value==="num";
    hTarget.style.display=show?"block":"none";
    tLabel.style.display=show?"block":"none";
  };
};

function render(){
  gallery.innerHTML="";
  state.habits.forEach(h=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="cardTop">
        <div class="cardTitle">
          <div class="habitName">${h.name}</div>
          <div class="meta">${h.type==="num"?"Numeric":"Yes/No"}</div>
        </div>
        <div class="actions">
          <button class="danger">Delete</button>
        </div>
      </div>
      <div class="months"></div>
    `;
    card.querySelector(".danger").onclick=()=>{
      if(confirm("Delete habit?")){
        state.habits=state.habits.filter(x=>x!==h);
        save();render();
      }
    };

    const monthsEl=card.querySelector(".months");
    for(let m=3;m>=0;m--){
      const d=new Date(today.getFullYear(),today.getMonth()-m,1);
      const month=document.createElement("div");
      month.className="month";
      month.innerHTML=`<div class="monthHead">${d.toLocaleString(undefined,{month:"short",year:"numeric"})}</div><div class="monthGrid"></div>`;
      const grid=month.querySelector(".monthGrid");
      for(let i=0;i<d.getDay();i++)grid.appendChild(document.createElement("div"));
      while(d.getMonth()===monthHeadDate(d)){
        const sq=document.createElement("div");
        sq.className="sq";
        const key=ymd(d);
        const v=h.logs[key];
        sq.dataset.level=v?h.type==="yn"?3:Math.min(3,Math.ceil(v/(h.target||1)*3)):0;
        if(key===ymd(today))sq.classList.add("today");
        sq.onclick=()=>{
          openModal(`
            <label>${h.name} – ${key}</label>
            ${h.type==="yn"
              ?`<select id="log"><option value="">—</option><option value="1">Yes</option><option value="0">No</option></select>`
              :`<input id="log" type="number" inputmode="numeric">`}
          `,()=>{
            const val=log.value;
            if(val==="")delete h.logs[key];
            else h.logs[key]=h.type==="yn"?val==="1":Number(val);
            save();modalBack.style.display="none";render();
          });
        };
        grid.appendChild(sq);
        d.setDate(d.getDate()+1);
      }
      monthsEl.appendChild(month);
    }

    gallery.appendChild(card);
    requestAnimationFrame(()=>monthsEl.scrollLeft=monthsEl.scrollWidth);
  });
}

function monthHeadDate(d){return d.getMonth()}
render();
</script>
</body>
</html>